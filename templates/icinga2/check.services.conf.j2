## OPTIONAL SERVICE DEFINITION ##

apply Service "URL Check - " for (http_vhost => config in host.vars.http_url) {
  import "generic-service"
  check_command = "http"
  vars.notification_mail = "true"
{% if icinga2_notification_telegram is defined %}
  vars.notification_telegram = "true"
{% endif %}

  vars += config
  notes = "HTTP checks for " + http_vhost
  vars.http_vhost = http_vhost
  vars.http_uri = config.http_uri
  vars.backup_downtime = config.backup_downtime

  assign where host.vars.http_url
}

apply Service "Mysql Check" {
  import "generic-service"
  check_command = "mysql"
  vars.notification_mail = "true"
{% if icinga2_notification_telegram is defined %}
  vars.notification_telegram = "true"
{% endif %}

  vars.mysql_user = host.vars.mysql_username
  vars.mysql_password = host.vars.mysql_password

  assign where host.vars.mysql == true
}

apply Service "Elasticsearch Check" {
  import "generic-service"
  check_command = "elasticsearch-server"
  vars.notification_mail = "true"
{% if icinga2_notification_telegram is defined %}
  vars.notification_telegram = "true"
{% endif %}

  vars.elasticsearch_host = host.vars.endpoint
  vars.elasticsearch_port = host.vars.elasticsearch_port

  assign where host.vars.elasticsearch == true
}

apply Service "Hadoop Check" {
  import "generic-service"
  check_command = "hadoop-server"
  vars.notification_mail = "true"
{% if icinga2_notification_telegram is defined %}
  vars.notification_telegram = "true"
{% endif %}

  vars.hadoop_nodes_warning = host.vars.hadoop_nodes_warning
  vars.hadoop_nodes_critical = host.vars.hadoop_nodes_critical
  command_endpoint = host.vars.endpoint

  assign where host.vars.hadoop == true
}

apply Service "File Count Check" for (folder => config in host.vars.filecount_path) {
  import "generic-service"
  check_command = "file-count"
  vars.notification_mail = "true"
{% if icinga2_notification_telegram is defined %}
  vars.notification_telegram = "true"
{% endif %}

  vars += config
  notes = "File Count Check for folder"
  vars.file_count_type = config.file_count_type
  vars.file_count_subs = config.file_count_subs
  vars.file_count_warntype = config.file_count_warntype
  vars.file_count_warncount = config.file_count_warncount
  vars.file_count_critcount = config.file_count_critcount
  vars.file_count_dir = folder
  command_endpoint = host.vars.endpoint

  assign where host.vars.filecount_path
}
